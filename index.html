<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Drum Helper</title>
    
    <!-- PWA y pantalla completa para iPad/iPhone -->
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="Drum Helper">
    <meta name="mobile-web-app-capable" content="yes">
    <meta name="theme-color" content="#000000">
    
    <!-- Prevenir zoom adicional en dispositivos iOS -->
    <meta name="format-detection" content="telephone=no">
    
    <!-- Manifest para PWA -->
    <link rel="manifest" href="manifest.json">
    
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <!-- Secci√≥n superior fija (1/4 de la pantalla) -->
    <header class="top-section">
        <div class="info-panel">
            <h1>Drum Helper</h1>
            <div id="version-code">v1.2.5</div>
            <div class="song-info">
                <span id="current-song">Selecciona una canci√≥n</span>
                <span id="current-bpm">BPM: 120</span>
                <span id="current-notes" class="song-notes"></span>
            </div>
        </div>
        
        <!-- Metr√≥nomo -->
        <div class="metronome-container">
            <div class="metronome-display">
                <div class="beat-indicator" id="beat-indicator" title="Clic: Reproducir/Pausar | Doble clic: Parar">
                    <div class="bpm-text" id="bpm-text">120</div>
                </div>
                <div class="bpm-display">
                    <div class="bpm-controls">
                        <button id="bpm-minus-10" class="bpm-btn">-10</button>
                        <button id="bpm-minus-1" class="bpm-btn">-1</button>
                    </div>
                    <input type="number" id="bpm-input" value="120" min="40" max="300">
                    <button id="tap-tempo-btn" class="control-btn">TAP</button>
                    <div class="bpm-controls">
                        <button id="bpm-plus-1" class="bpm-btn">+1</button>
                        <button id="bpm-plus-10" class="bpm-btn">+10</button>
                    </div>
                </div>
            </div>

        </div>
    </header>

    <!-- Contenedor principal -->
    <main class="main-container">
        <!-- Panel izquierdo - Lista de canciones (1/4 de la pantalla horizontal) -->
        <aside class="song-list-panel">
            <!-- Repertoire selector hidden - accessible through options button -->
            <select id="repertoire-select" class="repertoire-select" style="display: none;">
                <option value="default">Repertorio Principal</option>
            </select>
            <div class="song-search">
                <input type="text" id="search-input" placeholder="Buscar canci√≥n...">
            </div>
            <ul class="song-list" id="song-list">
                <!-- Las canciones se cargar√°n din√°micamente -->
            </ul>
            <div class="add-song-section">
                <button id="add-song-btn" class="add-btn">+ Agregar</button>
                <button id="edit-current-song-btn" class="edit-btn" disabled>Editar</button>
            </div>
            <div class="data-management">
                <button id="data-options-btn" class="data-btn">Opciones</button>
                <button id="repertoire-options-btn" class="repertoire-options-btn" title="Opciones de repertorio">‚öôÔ∏è</button>
                <input type="file" id="import-file-input" accept=".json" style="display: none;">
                <input type="file" id="import-txt-file-input" accept=".txt" style="display: none;">
                <input type="file" id="import-complete-file-input" accept=".txt" style="display: none;">
            </div>
        </aside>

        <!-- Panel central - Letras de la canci√≥n -->
        <section class="lyrics-panel">
            <div class="lyrics-container" id="lyrics-container">
                <div class="lyrics-content" id="lyrics-content">
                    <p class="welcome-message">
                        Bienvenido a Drum Helper
                        <br><br>
                        Selecciona una canci√≥n de la lista para ver sus letras.
                        <br><br>
                        Las letras se desplazar√°n autom√°ticamente seg√∫n el tempo del metr√≥nomo.
                    </p>
                </div>
            </div>
            
            <!-- Controles de desplazamiento -->
            <div class="scroll-controls">
                <div class="playback-controls">
                    <button id="restart-btn" class="scroll-btn">¬´</button>
                    <button id="play-pause-btn" class="scroll-btn">‚ñ∂</button>
                    <button id="record-btn" class="scroll-btn">üî¥</button>
                    <div class="timer-display">
                        <span id="timer-text">00:00</span>
                    </div>
                </div>
                <button id="scroll-up-btn" class="scroll-btn">‚Üë</button>
                <button id="auto-scroll-btn" class="scroll-btn active">A</button>
                <button id="scroll-down-btn" class="scroll-btn">‚Üì</button>
                <button id="scroll-to-top-btn" class="scroll-btn">‚áë</button>
                <div class="scroll-speed">
                    <label for="scroll-speed">Velocidad:</label>
                    <input type="range" id="scroll-speed" min="1" max="10" value="5">
                </div>
                <div class="font-size-controls">
                    <button id="font-size-minus" class="scroll-btn">A-</button>
                    <button id="font-size-plus" class="scroll-btn">A+</button>
                </div>
            </div>
        </section>
    </main>

    <!-- Modal para agregar canciones -->
    <div id="add-song-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Agregar Nueva Canci√≥n</h2>
            <form id="add-song-form">
                <div class="form-layout">
                    <div class="form-left">
                        <div class="form-group">
                            <label for="song-title">T√≠tulo:</label>
                            <input type="text" id="song-title" required>
                        </div>
                        <div class="form-group">
                            <label for="song-artist">Artista:</label>
                            <input type="text" id="song-artist">
                        </div>
                        <div class="form-group">
                            <label for="song-bpm">BPM:</label>
                            <input type="number" id="song-bpm" min="40" max="300" value="120">
                        </div>
                        <div class="form-group">
                            <label for="song-order">Orden:</label>
                            <input type="number" id="song-order" min="0" value="0" placeholder="Orden en la lista (0 por defecto)">
                        </div>
                        <div class="form-group">
                            <label for="song-duration">Duraci√≥n (mm:ss):</label>
                            <input type="text" id="song-duration" placeholder="3:50 (opcional)" pattern="^[0-9]{1,2}:[0-5][0-9]$" title="Formato: mm:ss (ej: 3:50)">
                        </div>
                        <div class="form-group">
                            <label for="song-notes">Notas:</label>
                            <textarea id="song-notes" rows="3" placeholder="Notas y comentarios sobre la canci√≥n..."></textarea>
                        </div>
                    </div>
                    <div class="form-right">
                        <div class="form-group">
                            <label for="song-lyrics">Letras:</label>
                            <textarea id="song-lyrics" rows="12" placeholder="Introduce las letras de la canci√≥n..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit">Guardar</button>
                    <button type="button" class="cancel-btn">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal para editar canciones -->
    <div id="edit-song-modal" class="modal">
        <div class="modal-content">
            <span class="close">&times;</span>
            <h2>Editar Canci√≥n</h2>
            <form id="edit-song-form">
                <input type="hidden" id="edit-song-id">
                <div class="form-layout">
                    <div class="form-left">
                        <div class="form-group">
                            <label for="edit-song-title">T√≠tulo:</label>
                            <input type="text" id="edit-song-title" required>
                        </div>
                        <div class="form-group">
                            <label for="edit-song-artist">Artista:</label>
                            <input type="text" id="edit-song-artist">
                        </div>
                        <div class="form-group">
                            <label for="edit-song-bpm">BPM:</label>
                            <input type="number" id="edit-song-bpm" min="40" max="300" value="120">
                        </div>
                        <div class="form-group">
                            <label for="edit-song-order">Orden:</label>
                            <input type="number" id="edit-song-order" min="0" value="0" placeholder="Orden en la lista">
                        </div>
                        <div class="form-group">
                            <label for="edit-song-duration">Duraci√≥n (mm:ss):</label>
                            <input type="text" id="edit-song-duration" placeholder="3:50 (opcional)" pattern="^[0-9]{1,2}:[0-5][0-9]$" title="Formato: mm:ss (ej: 3:50)">
                        </div>
                        <div class="form-group">
                            <label for="edit-song-notes">Notas:</label>
                            <textarea id="edit-song-notes" rows="3" placeholder="Notas y comentarios sobre la canci√≥n..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Informaci√≥n:</label>
                            <div class="song-info-display">
                                <div class="info-item">
                                    <span class="info-label">√öltima modificaci√≥n:</span>
                                    <span id="edit-song-last-modified" class="info-value">-</span>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div class="form-right">
                        <div class="form-group">
                            <label for="edit-song-lyrics">Letras:</label>
                            <textarea id="edit-song-lyrics" rows="12" placeholder="Introduce las letras de la canci√≥n..."></textarea>
                        </div>
                    </div>
                </div>
                <div class="form-actions">
                    <button type="submit">Actualizar</button>
                    <button type="button" class="cancel-btn">Cancelar</button>
                    <button type="button" id="delete-song-btn" class="delete-btn">Eliminar</button>
                </div>
                <div class="form-copy-section">
                    <h3>Copiar a otro repertorio</h3>
                    <div class="copy-controls">
                        <select id="copy-target-repertoire-select" class="copy-target-select">
                            <!-- Opciones se cargan din√°micamente -->
                        </select>
                        <button type="button" id="copy-song-btn" class="copy-btn" disabled>
                            üìÑ Copiar Canci√≥n
                        </button>
                    </div>
                </div>
            </form>
        </div>
    </div>

    <!-- Botones flotantes para control de modos -->
    <button id="mode-toggle-btn" class="mode-toggle-btn">
        Edici√≥n
    </button>
    
    <button id="songlist-toggle-btn" class="songlist-toggle-btn" style="display: none;">
        Lista
    </button>
    
    <!-- Botones de control para modos concierto/prompter -->
    <button id="concert-goto-top-btn" class="concert-control-btn" style="display: none;">
        üîù
    </button>
    
    <button id="concert-play-btn" class="concert-control-btn" style="display: none;">
        ‚ñ∂
    </button>

    <!-- Botones de navegaci√≥n para modo prompter -->
    <button id="prompter-prev-btn" class="prompter-control-btn" style="display: none;">
        ‚óÄ
    </button>
    
    <button id="prompter-next-btn" class="prompter-control-btn" style="display: none;">
        ‚ñ∂
    </button>

    <!-- Botones de control de reproducci√≥n para modo prompter -->
    <button id="prompter-goto-top-btn" class="prompter-control-btn" style="display: none;">
        üîù
    </button>
    
    <button id="prompter-play-btn" class="prompter-control-btn" style="display: none;">
        ‚ñ∂
    </button>
    
    <!-- T√≠tulo de canci√≥n para modo prompter -->
    <div id="prompter-song-title" class="prompter-song-title" style="display: none;">
        <span id="prompter-title-text">T√≠tulo de la canci√≥n</span>
    </div>

    <!-- Botones de navegaci√≥n para modo concierto y edici√≥n -->
    <button id="general-prev-btn" class="general-nav-btn" style="display: none;">
        ‚óÄ
    </button>
    
    <button id="general-next-btn" class="general-nav-btn" style="display: none;">
        ‚ñ∂
    </button>

    <!-- Modal de ayuda -->
    <div id="help-modal" class="help-modal">
        <div class="help-modal-content">
            <div class="help-modal-header">
                <h3>Atajos de Teclado</h3>
                <span class="help-close">&times;</span>
            </div>
            <div class="help-modal-body">
                <div class="shortcut-section">
                    <h4>Reproducci√≥n</h4>
                    <div class="shortcut-item">
                        <span class="key">Espacio</span>
                        <span class="description">Reproducir/Pausar</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">S</span>
                        <span class="description">Detener</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">‚Üë ‚Üì</span>
                        <span class="description">Ajustar velocidad</span>
                    </div>
                </div>
                
                <div class="shortcut-section">
                    <h4>Navegaci√≥n</h4>
                    <div class="shortcut-item">
                        <span class="key">‚Üê ‚Üí</span>
                        <span class="description">Cambiar canci√≥n</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">R</span>
                        <span class="description">Grabar desplazamiento</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">P</span>
                        <span class="description">Reproducir grabaci√≥n</span>
                    </div>
                </div>
                
                <div class="shortcut-section">
                    <h4>Modos de Vista</h4>
                    <div class="shortcut-item">
                        <span class="key">E</span>
                        <span class="description">Edici√≥n</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">C</span>
                        <span class="description">Concierto</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">T</span>
                        <span class="description">Prompter</span>
                    </div>
                </div>
                
                <div class="shortcut-section">
                    <h4>Orden de Canciones</h4>
                    <div class="shortcut-item">
                        <span class="key">O</span>
                        <span class="description">Activar modo orden</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">Shift + R</span>
                        <span class="description">Resetear orden</span>
                    </div>
                </div>
                
                <div class="shortcut-section">
                    <h4>Comandos en Letras</h4>
                    <div class="shortcut-item">
                        <span class="key">//img=archivo.jpg</span>
                        <span class="description">Insertar imagen</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">//espera=5</span>
                        <span class="description">Pausa de 5 segundos</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">::texto</span>
                        <span class="description">L√≠nea especial (se puede ocultar)</span>
                    </div>
                </div>
                
                <div class="shortcut-section">
                    <h4>Resaltado de Texto</h4>
                    <div class="shortcut-item">
                        <span class="key">/0texto0/</span>
                        <span class="description">Resaltado amarillo</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">/1texto1/</span>
                        <span class="description">Resaltado azul</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">/3texto3/</span>
                        <span class="description">Resaltado verde</span>
                    </div>
                    <div class="shortcut-item">
                        <span class="key">/0 al inicio</span>
                        <span class="description">Toda la l√≠nea amarilla</span>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de opciones de datos -->
    <div id="data-options-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 500px;">
            <div class="modal-header">
                <h2>Opciones de Datos</h2>
                <span id="close-data-options-modal" class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="data-options-section">
                    <h3>üì• Importar</h3>
                    <div class="data-options-grid">
                        <button id="modal-import-json-btn" class="data-option-btn">
                            <span class="option-text">Importar JSON</span>
                            <small>Archivo de respaldo completo</small>
                        </button>
                        <button id="modal-import-txt-btn" class="data-option-btn">
                            <span class="option-text">Importar TXT Simple</span>
                            <small>Formato b√°sico de texto</small>
                        </button>
                        <button id="modal-import-complete-btn" class="data-option-btn">
                            <span class="option-text">Importar Completas</span>
                            <small>Formato con todas las columnas</small>
                        </button>
                    </div>
                </div>
                
                <div class="data-options-section">
                    <h3>üì§ Exportar</h3>
                    <div class="data-options-grid">
                        <button id="modal-export-json-btn" class="data-option-btn">
                            <span class="option-text">Exportar JSON</span>
                            <small>Respaldo completo de todas las canciones</small>
                        </button>
                    </div>
                </div>
                
                <div class="data-options-section">
                    <h3>üóëÔ∏è Gesti√≥n</h3>
                    <div class="data-options-grid">
                        <button id="modal-clear-all-btn" class="data-option-btn danger">
                            <span class="option-text">Borrar Todas</span>
                            <small>Eliminar todas las canciones</small>
                        </button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de gesti√≥n de repertorios -->
    <div id="repertoire-options-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Gesti√≥n de Repertorios</h3>
                <span id="close-repertoire-options-modal" class="close">&times;</span>
            </div>
            <div class="modal-body">
                <div class="repertoire-management-section">
                    <h4>Repertorio Actual: <span id="current-repertoire-name">Repertorio Principal</span></h4>
                    
                    <div class="repertoire-actions">
                        <button id="new-repertoire-btn" class="repertoire-action-btn">
                            üìÅ Nuevo Repertorio
                        </button>
                        <button id="duplicate-repertoire-btn" class="repertoire-action-btn">
                            üìÑ Duplicar Actual
                        </button>
                        <button id="rename-repertoire-btn" class="repertoire-action-btn">
                            ‚úèÔ∏è Renombrar
                        </button>
                        <button id="delete-repertoire-btn" class="repertoire-action-btn danger" style="display: none;">
                            üóëÔ∏è Eliminar
                        </button>
                    </div>

                    <div class="repertoire-display-section">
                        <h4>Configuraci√≥n de Visualizaci√≥n</h4>
                        <div class="display-options">
                            <label class="checkbox-label">
                                <input type="checkbox" id="show-artist-bpm-checkbox" checked>
                                <span class="checkbox-text">Mostrar artista y BPM en lista de canciones</span>
                            </label>
                            <label class="checkbox-label">
                                <input type="checkbox" id="hide-notes-checkbox">
                                <span class="checkbox-text">Ocultar notas marcadas con :: en las letras</span>
                            </label>
                        </div>
                    </div>

                    <div class="repertoire-ordering-section">
                        <h4>Ordenamiento de Canciones</h4>
                        <div class="ordering-actions">
                            <button id="order-mode-btn" class="repertoire-action-btn" title="Activar modo ordenamiento">
                                üìã Modo Ordenamiento
                            </button>
                            <button id="reset-order-btn" class="repertoire-action-btn" style="display: none;" title="Resetear todos los valores de orden a 0">
                                üóëÔ∏è Resetear Orden
                            </button>
                        </div>
                    </div>
                    
                    <div class="repertoire-list-section">
                        <h4>Repertorios Disponibles</h4>
                        <div id="repertoire-list" class="repertoire-list">
                            <!-- Lista de repertorios se carga din√°micamente -->
                        </div>
                    </div>
                    
                    <div class="song-transfer-section" style="display: none;">
                        <h4>Transferir Canciones</h4>
                        <div class="transfer-controls">
                            <select id="target-repertoire-select" class="target-repertoire-select">
                                <!-- Opciones se cargan din√°micamente -->
                            </select>
                            <div class="selected-songs" id="selected-songs-list">
                                <!-- Canciones seleccionadas -->
                            </div>
                            <button id="transfer-songs-btn" class="transfer-btn" disabled>
                                Transferir Canciones Seleccionadas
                            </button>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal para nombrar repertorio -->
    <div id="repertoire-name-modal" class="modal" style="display: none;">
        <div class="modal-content" style="max-width: 400px;">
            <div class="modal-header">
                <h3 id="repertoire-name-modal-title">Nuevo Repertorio</h3>
                <span id="close-repertoire-name-modal" class="close">&times;</span>
            </div>
            <div class="modal-body">
                <form id="repertoire-name-form">
                    <div class="form-group">
                        <label for="repertoire-name-input">Nombre del repertorio:</label>
                        <input type="text" id="repertoire-name-input" required maxlength="50">
                    </div>
                    <div class="form-buttons">
                        <button type="submit" class="btn-primary">Guardar</button>
                        <button type="button" id="cancel-repertoire-name" class="btn-secondary">Cancelar</button>
                    </div>
                </form>
            </div>
        </div>
    </div>

    <script src="js/metronome.js"></script>
    <script src="js/songManager.js"></script>
    <script src="js/lyricsScroller.js"></script>
    <script src="js/app.js"></script>
</body>
</html>
